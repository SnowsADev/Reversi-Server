"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return t=_toPropertyKey(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Game=function(e){var t={environment:"development",spelToken:null,spelerToken:null,backendAdress:"https://localhost:44378"},n=null,a=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"development",a=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;t.environment=n,t.spelerToken=a,t.spelToken=o,Game.Template.init(),Game.API.init(),Game.Data.init(),Game.Reversi.init(),Game.Stats.init(),console.log("Game initialized"),console.log("Game running in ".concat(n," mode")),r().then(function(){return Game.API.showRelevantNews(e("#swiper-container"))})},r=function(){var e="development"===i()?"api/game.json":s()+"/"+c();return Game.Data.get(e).then(function(e){var t="development"===i()?e:JSON.parse(e);d(t)}).catch(function(e){console.error(e)})},o=function(){Game.Stats.showCharts(e("#charts-container"),"spp","of"),Game.Reversi.show("#main-content")},i=function(){return t.environment},l=function(){return t.spelerToken},c=function(){return t.spelToken},s=function(){switch(i()){case"development":return"api/game.json";case"production":return"/api/spel"}},u=function(){return null},p=function(){return null===n&&r(),n},d=function(e){n=e,o()};return{init:a,getEnvironment:i,getSpelerToken:l,getSpelToken:c,getSpeler:u,getGameState:p,setGameState:d,refresh:r}}(jQuery);Game.API=function(){var e=function(){switch(Game.getEnvironment()){case"development":return Game.Data.get("api/api.json");case"production":var e="https://newsapi.org/v2/top-headlines",t={today:(new Date).toISOString().split("T")[0],sortBy:"popularity",country:"nl",apiKey:"8b95393f1cc34b22b5d9f17892e4099e"},n="".concat(e,"?from=").concat(t.today,"&sortBy=").concat(t.sortBy,"&country=").concat(t.country,"&apiKey=").concat(t.apiKey);return Game.Data.get(n)}},t=function(e){return Game.Template.parseTemplate("artiekelen",e)},n=function(e,t){$("#swiper-container").append(e),new Swiper("#swiper-container",{direction:"vertical",loop:!0,mousewheel:!0,slidesPerView:2,pagination:{el:".swiper-pagination",clickable:!0,type:"progressbar"}})};return{init:function(){console.log("Game.API initialized")},showRelevantNews:function(a){e().then(function(e){var r=t(e);n(r,a)}).catch(function(e){console.log("Failed to get news from API")})}}}(),Game.Data=function(){var e={signalRHub:"/SpelHub"},t=null,n=function(){"production"===Game.getEnvironment()&&(t=(new signalR.HubConnectionBuilder).withUrl(e.signalRHub).build(),t.on("ReceiveRefreshGameNotification",o),t.on("ReceiveJoinRequest",r),t.on("ReceiveErrorMessage",a),t.start().then(function(){return console.log("SignalR started successfully")}).catch(function(e){return console.error(e.toString())})),console.log("Game.Data initialized")},a=function(e){console.debug('Error! :"'.concat(e,'"'));var t={success:!1,image:"/images/Error_Icon.png",content:e},n=Game.Template.parseTemplate("notificatie",t);$(".notification-container").append(n).ready(function(){$(".popup .popup__btn--decline").click(l),$(".popup .popup__button--close").click(l)})},r=function(e,t,n){var a=_defineProperty(_defineProperty({success:!0,image:"development"===Game.getEnvironment()?"":"~/images/Succes_Icon.png",content:e,spelerId:n},"spelerId",n),"spelId",t),r=Game.Template.parseTemplate("notificatie",a);$(".notification-container").append(r).ready(function(){$(".popup .popup__btn--accept").click(i),$(".popup .popup__btn--decline").click(l),$(".popup .popup__button--close").click(l)})},o=function(){Game.refresh()},i=function(e){e.preventDefault();var n=$(this).closest(".popup");"development"!==Game.getEnvironment()?t.invoke("SendJoinRequestResult",n[0].dataset.spelid,n[0].dataset.spelerid,!0).then(function(){l(e)}).then(function(){return Game.refresh()}).catch(function(e){return console.error(e.toString())}):l(e)},l=function(e){e.preventDefault();var t=$(e.currentTarget).closest(".popup");t.addClass("popup--state-closing"),setTimeout(function(){t.remove()},500)};return{init:n,get:function(e){return new Promise(function(t,n){return $.ajax({url:e,success:function(e){return t(e)},error:function(e){return n(e)}})})},put:function(e,t){return new Promise(function(n,a){return $.ajax({url:e,contentType:"application/json",type:"PUT",data:JSON.stringify(t),success:function(e){return n(e)},error:function(e){console.error(e),a(e)}})})}}}(),Game.Reversi=function(){var e=!0,t=function(){console.log("Game.Reversi initialized ")},n=function(t){var n=Game.getGameState();if(e=n.Spelers.length<2,null===Game.getGameState())return void console.error("GameState was not found");var o=e||n.SpelIsAfgelopen;r(t,o),n.SpelIsAfgelopen&&a(t)},a=function(e){var t,n=Game.getGameState(),a=n.Bord.flat();if("development"===Game.getEnvironment())t=0;else{var r=n.Spelers.find(function(e){return e.Id===Game.getSpelerToken()}).Kleur,o={aantalWit:a.filter(function(e){return 1===e}).length,aantalZwart:a.filter(function(e){return 2===e}).length};if(o.aantalWit===o.aantalZwart)t=2;else switch(r){case 1:t=o.aantalWit>o.aantalZwart?1:0;break;case 2:t=o.aantalZwart>o.aantalWit?1:0}}var i=Game.Template.parseTemplate("afgelopen",{resultaat:t}),l=$(e);l.find(".afgelopen").length>0?l.find(".afgelopen").replaceWith(i):l.append(i)},r=function(e,t){var n=Game.Template.parseTemplate("speelbord",{disabled:t,bord:Game.getGameState().Bord}),a=$(e);a.find(".bord__wrapper, .bord__wrapper--disabled").length>0?a.find(".bord__wrapper, .bord__wrapper--disabled").replaceWith(n):a.append(n),t||o()},o=function(){var e=$("#bord__table td");e.click(i),e.mouseenter(c),e.mouseleave(c)},i=function(t){if(t.preventDefault(),!e&&!1!==s()){var n=$(this),a=parseInt(n[0].parentNode.id),r=parseInt(n[0].id);l(a,r)&&"development"!==Game.getEnvironment()&&Game.Data.put("/api/spel/zet",{RijZet:a,KolomZet:r,SpelToken:Game.getSpelToken(),SpelerToken:Game.getSpelerToken()}).then(function(e){Game.setGameState(JSON.parse(e))})}},l=function(e,t){return Game.getGameState().MogelijkeZetten.some(function(n){return n.x===e&&n.y===t})},c=function(t){var n=$(this),a=parseInt(n[0].parentNode.id),r=parseInt(n[0].id);if(!e&&s())switch(t.type){case"mouseenter":l(a,r)&&n.addClass("bord__td--active");break;case"mouseleave":n.removeClass("bord__td--active")}},s=function(){return"development"===Game.getEnvironment()||Game.getGameState().AandeBeurt===Game.getGameState().Spelers.find(function(e){return e.Id===Game.getSpelerToken()}).Kleur};return{init:t,show:n}}(),Game.Stats=function(){var e={containerId:"chart-container",stonesPerPlayerChart:{chart:null,data:{labels:[],datasets:[{label:"Aantal stenen Wit",data:[],borderColor:"#2a3ab5",backgroundColor:"#2a3ab5"},{label:"Aantal stenen Zwart",data:[],borderColor:"#b52a2c",backgroundColor:"#b52a2c"}]}},occupiedFieldsChart:{chart:null,data:{labels:[],datasets:[{label:"Aantal bezette velden",data:[],borderColor:"#b52a2c",backgroundColor:"#b52a2c"}]}}},t=function(){console.log("Game.Stats initialized")},n=function(t,n,a){var r=Game.Template.parseTemplate("stats",{id:n}),o=Game.Template.parseTemplate("stats",{id:a}),t=$(t);null===e.occupiedFieldsChart.chart&&null===e.stonesPerPlayerChart.chart&&(t.append(r),t.append(o)),l(n,a)},a=function(){return new Promise(function(e,t){var n=Game.getGameState();if(null!==n)return o(n.Bord),r(n.Bord),void e();t()})},r=function(t){var n=0;t.forEach(function(e){e.forEach(function(e){1!==e&&2!==e||n++})}),e.occupiedFieldsChart.data.labels.push(i()),e.occupiedFieldsChart.data.datasets[0].data.push(n),null!==e.occupiedFieldsChart.chart&&e.occupiedFieldsChart.chart.update()},o=function(t){var n=0,a=0;t.forEach(function(e){e.forEach(function(e){1===e&&n++,2===e&&a++})}),e.stonesPerPlayerChart.data.labels.push(i()),e.stonesPerPlayerChart.data.datasets[0].data.push(n),e.stonesPerPlayerChart.data.datasets[1].data.push(a),null!==e.stonesPerPlayerChart.chart&&e.stonesPerPlayerChart.chart.update()},i=function(){var e=new Date,t=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),a=e.getSeconds().toString().padStart(2,"0");return"".concat(t,":").concat(n,":").concat(a)},l=function(t,n){a().then(function(){var a=e.stonesPerPlayerChart.chart,r=e.occupiedFieldsChart.chart;null!==a&&void 0!==a||(e.stonesPerPlayerChart.chart=c(t,"Aantal stenen per speler",e.stonesPerPlayerChart.data)),null!==r&&void 0!==r||(e.occupiedFieldsChart.chart=c(n,"Aantal bezette velden",e.occupiedFieldsChart.data)),$("#"+t).show(),$("#"+n).show()}).catch(function(e){console.error(e),$("#"+t).hide(),$("#"+n).hide()})},c=function(e,t,n){var a={type:"line",data:n,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:t}},scales:{y:{min:0,ticks:{stepSize:5}}}}};return new Chart(e,a)};return{init:t,showCharts:n}}(),Game.Template=function(){function e(e){return spa_templates.templates[e]}function t(t,n){return e(t)(n)}return _defineProperty(_defineProperty(_defineProperty({init:function(){console.log("Game.Template initialized")},getTemplate:e},"getTemplate",e),"parseTemplate",t),"parseTemplate",t)}();